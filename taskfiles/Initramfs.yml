version: '3'

tasks:
  # Assemble the LinuxBoot initramfs
  bootldr-cpio:
    dir: build/boot
    cmds:
      - echo "Assembling LinuxBoot initramfs..."
      - ./cpio -out bootldr.cpio loader keys/u-bmc.pub ../kmod/*.ko
      - echo "Done!"
    status:
      - test -f bootldr.cpio

  # Assemble the mount helper initramfs
  runtime-cpio:
    dir: build/boot
    cmds:
      - echo "Assembling runtime initramfs..."
      - ./cpio -out runtime.cpio loader
      - echo "Done!"
    status:
      - test -f runtime.cpio

  # Helper task to create some auxiliary files
  cpio-files:
    dir: build/boot
    cmds:
      # Needed because not all targets have modules
      - mkdir -p ../kmod
      - touch ../kmod/stub.ko
    status:
      - test -f ../kmod/stub.ko
